<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>
  <input type="submit" id="login" name="login" value="Login" />
  <canvas id="userLoginChart" width="400" height="200"></canvas>
</body>
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getDatabase, set, ref, update, } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAxDiiZzecf-x9JcLsxSu6_zCimOOcMiro",
      authDomain: "aarthinew-2aa7f.firebaseapp.com",
      databaseURL: "https://aarthinew-2aa7f-default-rtdb.firebaseio.com",
      projectId: "aarthinew-2aa7f",
      storageBucket: "aarthinew-2aa7f.appspot.com",
      messagingSenderId: "47934433889",
      appId: "1:47934433889:web:d309fbb8e4cba978fed820"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();

    // After the other JavaScript code, add the following code:

// Get the canvas element and create a chart context
const chartCanvas = document.getElementById('userLoginChart');
const chartContext = chartCanvas.getContext('2d');

// Create an empty data array and labels for the chart
const chartData = {
  labels: [], // Array to store labels (e.g., time)
  datasets: [
    {
      label: 'Login Count',
      data: [], // Array to store the number of logins
      fill: true,
      borderColor: 'rgba(75, 192, 192, 1)',
      tension: 0.1,
    },
  ],
};

// Create a new Chart using Chart.js
const userLoginChart = new Chart(chartContext, {
  type: 'line',
  data: chartData,
  options: {
    scales: {
      x: {
        display: true,
        title: {
          display: true,
          text: 'Time',
        },
      },
      y: {
        display: true,
        title: {
          display: true,
          text: 'Login Count',
        },
      },
    },
  },
});

// Function to update the chart
function updateChart(loginCount) {
  const timeNow = new Date().toLocaleTimeString(); // Get the current time
  userLoginChart.data.labels.push(timeNow); // Add the time as a label
  userLoginChart.data.datasets[0].data.push(loginCount); // Add the login count
  userLoginChart.update(); // Update the chart
}

// Call the updateChart function when a user logs in
login.addEventListener('click', (e) => {
  var email = document.getElementById('email1').value;
  var password = document.getElementById('password1').value;

  signInWithEmailAndPassword(auth, email, password)
    .then((userCredential) => {
      // Signed in
      const user = userCredential.user;
      console.log(user);

      const dt = new Date();
      update(ref(database, 'users/' + user.uid), {
        last_login: dt,
      });

      dspEmail.textContent = user.email;
      status.textContent = user.emailVerified;
      
      // Call the updateChart function to update the chart with the new login
      updateChart(userLoginChart.data.datasets[0].data.length);
      
      alert('User logged in!');
    })
    .catch((error) => {
      const errorCode = error.code;
      const errorMessage = error.message;
      alert(errorMessage);
    });
});




</script>
</html>